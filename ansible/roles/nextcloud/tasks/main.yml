---
# Main tasks for Nextcloud deployment

- name: Include Docker deployment tasks
  include_tasks: docker.yml
  tags:
    - nextcloud
    - docker

- name: Include installation tasks
  include_tasks: install.yml
  tags:
    - nextcloud
    - install

- name: Include OIDC configuration tasks
  include_tasks: oidc.yml
  when: nextcloud_oidc_enabled | default(true)
  tags:
    - nextcloud
    - oidc

- name: Include apps installation and configuration
  include_tasks: apps.yml
  tags:
    - nextcloud
    - apps

- name: Include email configuration
  include_tasks: email.yml
  when: mailgun_smtp_user is defined or (client_secrets.mailgun_smtp_user is defined and client_secrets.mailgun_smtp_user != "" and "PLACEHOLDER" not in client_secrets.mailgun_smtp_user)
  tags:
    - nextcloud
    - email
